const headers = { "Content-Type": "application/json" };
const loginUser = sessionStorage.getItem("name");

console.log(loginUser);

// 유저 로그인 상태 => 로그인/회원가입li를 로그아웃li로 변환
if (loginUser) {
	document.getElementById("loginSpan").innerHTML = `
		<li class="nav-item">
		<a class="nav-link active" href="#" id="logoutBtn">${loginUser}님 logout</a>
		</li>
	`;

	// 로그인한 상태에서만 로그아웃 가능
	const logoutBtn = document.getElementById("logoutBtn");
	logoutBtn.addEventListener("click", async function () {
		fetch('members/logout', {
			method: "get"
		});

		sessionStorage.removeItem("name");
		location.reload();
	});
}

// 유저 로그인
document.getElementById("loginBtn").addEventListener("click", async function () {
	const email = document.getElementById("login_email").value;
	const pw = document.getElementById("login_pw").value;

	let body = { email, pw };
	body = JSON.stringify(body);
	await fetch('members/login', {
		method: "post",
		headers,
		body
	}).then(async (res) => {
		res = await res.json();
		if (res.email) {
			sessionStorage.setItem("email", res.email);
			sessionStorage.setItem("name", res.name);
			alert("로그인 성공!")
			location.reload();
		} else {
			alert("로그인 실패!")
		}
	}).catch(err => console.log(err))
});

// 유저 회원가입
document.getElementById("registBtn").addEventListener("click", async function () {
	const name = document.getElementById("regist_name").value;
	const email = document.getElementById("regist_email").value;
	const pw = document.getElementById("regist_pw").value;
	const ssn = document.getElementById("regist_ssn").value;

	let body = { name, email, pw, ssn };
	body = JSON.stringify(body);

	await fetch('members/regist', {
		method: "post",
		headers,
		body
	}).then(async (res) => {
		res = await res.json();
		if (res.msg === "success") {
			alert("회원가입 성공!")
			location.reload();
		} else { // res.msg === "fail"
			alert("회원가입 실패!");
		}
	}).catch(err => console.log(err))
});