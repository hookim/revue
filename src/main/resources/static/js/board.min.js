window.onload = async () => {
	let body = await fetch("board/", { method: "get" });
	body = await body.json();
	boardList(body);
};

const userEmail = sessionStorage.getItem("email");

if (!userEmail) {
	document.getElementById("addPostBtn").classList.add("disabled");
}

function boardList(body) {
	let list = "";
	body.forEach(function (post) {
		list += `
			<tr>
		        <td><a href="#" onClick="selectPost('${post.no}')")>${post.no}</a></td>
		        <td>${post.title}</td>
		        <td>${post.content}</td>
		        <td>${post.email}</td>
		        <td>${post.created_time}</td>
	      	</tr>
			`;
	});

	document.getElementById("listTableBody").innerHTML = list;
}

document.getElementById("addPostBtn").addEventListener("click", function () {
	document.getElementById("boardBody").innerHTML = `
		<h3>게시글 등록</h3>
		<hr>
		<div class="container mt-3 d-flex flex-column justify-content-center">
			<div class="input-group mb-3">
				<span class="input-group-text">제목</span>
				<input type="text" class="form-control" name="title" id="title">
			</div>

			<div class="input-group mb-3">
				<span class="input-group-text">작성자</span>
				<input type="text" class="form-control" name="author" readonly value="${sessionStorage.getItem("name")}"></input>
			</div>

			<div class="input-group mb-3">
				<textarea class="form-control" rows="10" name="content" placeholder="내용을 입력해주세요..." id="content"></textarea>
			</div>

			<div class="d-flex flex-row justify-content-center">
				<button class="btn btn-outline-dark" onClick="registPost()">등록</button>
				<button class="ms-3 btn btn-outline-dark" onClick="goHome()">취소</button>
			<div>
		</div>
		`;
});

function goHome() {
	location.reload();
}

async function registPost() {
	const title = document.getElementById("title").value;
	const content = document.getElementById("content").value;
	const email = sessionStorage.getItem("email");

	const formData = new FormData();
	formData.append("title", title);
	formData.append("content", content);
	formData.append("email", email);

	let body = formData;
	body = await fetch("board/regist", { method: "post", body });
	if (body) {
		body = await body.json();
		//console.log(body);
		alert("게시글 등록 성공!")
		location.reload();
	} else {
		alert("게시글 등록 실패!")
	}
}

async function selectPost(no) {
	let body = await fetch(`board/${no}`, { method: "get" });
	body = await body.json();
	//console.log(body);

	document.getElementById("boardBody").innerHTML = `
	<table class="table table-striped">
	    <thead>
	      <tr>
	        <td>번호</td> <td>${body.no}</td>
          </tr>
          <tr>
          	<td>제목</td> <td>${body.title}</td>
          </tr>
          <tr>
          	<td>내용</td> <td>${body.email}</td>
          </tr>
          <tr>
          	<td>작성자</td> <td>${body.content}</td>
          </tr>
          <tr>
          	<td>작성시간</td> <td> ${body.created_time} </td>
          </tr>
	    </thead>
	    <tbody>
	    </tbody>
    </table>
		<button class="ms-3 btn btn-outline-dark" onClick="goHome()">취소</button>
	`;

};